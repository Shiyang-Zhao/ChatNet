{% load static %}

<div>
    <button type="button" class="btn" style="padding: 0; background: none; border: none; outline: none;"
        data-bs-toggle="modal" data-bs-target="#storyModal">
        <img src="{{ viewed_user.profile.profile_image.url }}" alt="{{ viewed_user.username }}'s Profile Image"
            class="rounded-circle img-fluid position-absolute top-0 start-0"
            style="object-fit: cover; width: 100%; height: 100%;">
    </button>

    <div class="modal fade" id="storyModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-body bg-black" style="position: relative;">
                    <div id="progress-container" class="progress"
                        style="height: 4px; background-color: transparent; overflow: hidden;">
                        {% for story in active_stories %}
                        <div class="progress-bar rounded" id="progress-{{ forloop.counter }}" role="progressbar"></div>
                        {% endfor %}
                    </div>
                    {% for story in active_stories %}
                    <div class="story-content mt-3" id="story-{{ story.pk }}" style="display: none;">
                        {% if story.file %}
                        {% if story.file_extension in '.mp4, .avi, .mov, .mkv, .flv, .wmv, .webm' %}
                        <video controls class="img-fluid mb-3">
                            <source src="{{ story.file.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        {% else %}
                        <img src="{{ story.file.url }}" alt="Story image" class="img-fluid mb-3">
                        {% endif %}
                        {% endif %}
                        <p class="text-white">{{ story.content }}</p>
                    </div>
                    {% endfor %}
                    <div class="left-area"
                        style="position: absolute; left: 0; top: 0; bottom: 0; width: 50%; cursor: pointer;">
                    </div>
                    <div class="right-area"
                        style="position: absolute; right: 0; top: 0; bottom: 0; width: 50%; cursor: pointer;">
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<style>
    .progress-bar {
        width: 100%;
        /* Ensure this spans the full width of its container */
        margin-right: 5px;
        /* Set a fixed height for the progress bar */
        background: linear-gradient(to right, rgba(255, 255, 255, 1) 50%, rgba(255, 255, 255, 0.5) 50%);
        background-size: 200% 100%;
        background-position: 100% center;
    }
</style>

{% block javascripts %}
<script src="{% static 'js/stories/story_detail.js' %}"></script>
{% endblock %}