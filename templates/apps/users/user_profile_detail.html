{% extends 'base.html' %}
{% load static %}
{% load profile_tags %}

{% block title %}{{viewed_user.username }}'s Profile{% endblock %}

{% block content %}
{% check_profile_follow_status user viewed_user as is_following %}
<div class="container mt-5 d-flex flex-column align-items-center">
  <div class="profile-header d-flex align-items-ceneter">
    <div id="story-container-{{ viewed_user.username }}" class="story-container position-relative me-4"
      style="width: 150px; height: 150px;">
      {% include 'components/stories/story_item.html' with active_stories=active_stories viewed_user=viewed_user %}
    </div>

    <div>
      <h2>{{ viewed_user.username }}</h2>
      <p>Bio: {{ viewed_user.profile.bio }}</p>
      {% if participant.activity_status == -1 %}
      <small class="text-muted">Never online</small>
      {% elif participant.activity_status > 2 %}
      <small class="text-muted">Online {{ participant.activity_status }} minutes ago</small>
      {% else %}
      <small class="text-success">
        <i class="fa fa-circle text-success me-1"></i>Online
      </small>
      {% endif %}
      {% include 'components/users/follower_and_following_detail.html' with viewed_user=viewed_user %}
    </div>
  </div>

  <div class="d-flex justify-content-evenly align-items-ceneter mt-4 col-lg-8">
    {% if viewed_user == user %}
    <a href="{% url 'user-profile-update' %}" class="btn btn-dark">Edit Profile</a>
    <a href="{% url 'post-create' %}" class="btn btn-dark">Create Post</a>
    <a href="{% url 'story-create' %}" class="btn btn-dark">Create Story</a>
    {% else %}
    {% if is_following %}
    <form method="post" action="{% url 'unfollow-profile' username=viewed_user.username %}" class="follow-unfollow-form"
      data-follow-url="{% url 'follow-profile' username=viewed_user.username %}"
      data-unfollow-url="{% url 'unfollow-profile' username=viewed_user.username %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-secondary following">Following</button>
    </form>
    {% else %}
    <form method="post" action="{% url 'follow-profile' username=viewed_user.username %}" class="follow-unfollow-form"
      data-follow-url="{% url 'follow-profile' username=viewed_user.username %}"
      data-unfollow-url="{% url 'unfollow-profile' username=viewed_user.username %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary follow">Follow</button>
    </form>
    {% endif %}
    <form id="messageForm" method="post"
      action="{% url 'private-chat-create' receiver_username=viewed_user.username %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary">Message</button>
    </form>
    {% endif %}
  </div>

  {% include 'components/users/user_profile_sections.html' with viewed_user=viewed_user %}
</div>
{% endblock %}

{% block javascripts %}
<script src="{% static 'apps/js/users/user_profile_detail.js' %}"></script>
{% endblock %}