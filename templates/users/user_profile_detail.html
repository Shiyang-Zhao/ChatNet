{% extends 'base.html' %} {% load static %}
{% block title %}{{viewed_user.username }}'s Profile{% endblock %}
{% block content %}
<div class="container mt-5">
  <div class="profile-header d-flex align-items-center">
    {% if viewed_user.profile.profile_image %}
    <img src="{{ viewed_user.profile.profile_image.url }}" alt="{{ viewed_user.username }}'s Profile Image"
      class="profile-image rounded-circle" width="150" />
    {% else %}
    <img src="/static/images/default_profile_image.png" alt="Default Profile Image" class="profile-image rounded-circle"
      width="150" />
    {% endif %}

    <div class="ml-4">
      <h2>{{ viewed_user.username }}</h2>
      <p>{{ viewed_user.profile.bio }}</p>
    </div>
  </div>

  <div class="profile-details mt-4">
    <p><strong>Location:</strong> {{ viewed_user.profile.location }}</p>

    <p>
      <strong>Website:</strong>
      {% if viewed_user.profile.website %}
      <a href="{{ viewed_user.profile.website }}" target="_blank" rel="noopener noreferrer">
        {{ viewed_user.profile.website }}
      </a>
      {% else %} No website listed. {% endif %}
    </p>

    <p><strong>Email:</strong> {{ viewed_user.email }}</p>
    <p><strong>First Name:</strong> {{ viewed_user.first_name }}</p>
    <p><strong>Last Name:</strong> {{ viewed_user.last_name }}</p>

    {% if viewed_user.profile.birthday %}
    <p>
      <strong>Birthday:</strong> {{ viewed_user.profile.birthday|date:"F j, Y,
      G:i" }}
    </p>
    {% endif %} {% if viewed_user == user %}
    <div>
      <a href="{% url 'user-profile-update' %}" class="btn btn-primary">Update Profile</a>
    </div>
    {% else %}
    <div>
      {% if is_following %}
      <button class="btn btn-secondary following"
        data-follow-url="{% url 'follow-profile' username=viewed_user.username %}"
        data-unfollow-url="{% url 'unfollow-profile' username=viewed_user.username %}"
        data-action-url="{% url 'unfollow-profile' username=viewed_user.username %}">
        Following
      </button>
      {% else %}
      <button class="btn btn-primary follow" data-follow-url="{% url 'follow-profile' username=viewed_user.username %}"
        data-unfollow-url="{% url 'unfollow-profile' username=viewed_user.username %}"
        data-action-url="{% url 'follow-profile' username=viewed_user.username %}">
        Follow
      </button>
      {% endif %}

      <form id="messageForm" method="post"
        action="{% url 'private-chat-create' receiver_username=viewed_user.username %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">Message</button>
      </form>
    </div>
    {% endif %}

    <div>
      <h3>Posts by {{ viewed_user.username }}</h3>
      <ul>
        {% for post in viewed_user.posts.all %}
        <li>
          <a href="{% url 'post-detail' pk=post.pk %}">{{ post.title }}</a>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div>
      <h3>Liked Posts</h3>
      <ul>
        {% for post in user.liked_posts.all %}
        <li>
          <a href="{% url 'post-detail' pk=post.pk %}">{{ post.title }}</a>
        </li>
        {% empty %}
        <li>No liked posts.</li>
        {% endfor %}
      </ul>
    </div>

    <div>
      <h3>Disliked Posts</h3>
      <ul>
        {% for post in user.disliked_posts.all %}
        <li>
          <a href="{% url 'post-detail' pk=post.pk %}">{{ post.title }}</a>
        </li>
        {% empty %}
        <li>No disliked posts.</li>
        {% endfor %}
      </ul>
    </div>

    <div>
      <h3>Commented Posts</h3>
      {% for comment in user.posted_comments.all %}
      <li>
        <strong>Comment on
          <a href="{% url 'post-detail' pk=comment.post.pk %}">
            {{ comment.post.title}}
          </a>
        </strong>
        "{{ comment.content|truncatewords:20 }}"
        <small>â€” posted on {{ comment.date_posted|date:"F j, Y, G:i" }}</small>
      </li>
      {% empty %}
      <li>No posts commented on.</li>
      {% endfor %}
    </div>
  </div>
</div>
<script type="module" src="{% static 'js/users/user_profile_detail.js' %}"></script>

{% endblock %}